{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 34, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/xiaof/Desktop/staff-activity-tracker%20%282%29/staff-activity-tracker/app/api/extract-activities/route.ts"],"sourcesContent":["const ACTIVITY_PATTERNS = [\n  { key: \"new_clients\", patterns: [\"today added new clients\", \"new clients\", \"today.*new.*client\"] },\n  { key: \"today_trust_love\", patterns: [\"today.*trust.*love\", \"today's trust/love\", \"trust/love.*today\"] },\n  { key: \"total_trust_love\", patterns: [\"total trust.*love\", \"total.*trust/love\"] },\n  { key: \"today_hot_chat\", patterns: [\"today.*hot chat\", \"today's hot chat\", \"hot chat.*today\"] },\n  { key: \"total_hot_chat\", patterns: [\"total hot chat\", \"total.*hot.*chat\"] },\n  { key: \"today_test_size_cut\", patterns: [\"today.*test size cut\", \"test size cut.*today\", \"today's test size\"] },\n  { key: \"today_size_cut\", patterns: [\"today.*size cut\", \"today's size cut\", \"size cut.*today\"] },\n  { key: \"today_new_free_task\", patterns: [\"today.*new free task\", \"today's new free task\", \"new free task.*today\"] },\n  { key: \"total_free_task\", patterns: [\"total free task\", \"total.*free.*task\"] },\n  {\n    key: \"today_promote_topup\",\n    patterns: [\"today.*promote top-up\", \"today's promote top-up\", \"promote top-up.*today\", \"today.*promote.*topup\"],\n  },\n  {\n    key: \"today_promote_success\",\n    patterns: [\"today.*promote success\", \"today's promote success\", \"promote success.*today\"],\n  },\n  {\n    key: \"today_new_interesting_clients\",\n    patterns: [\"today.*new interesting\", \"today's new interesting\", \"new interesting.*today\", \"interesting client\"],\n  },\n  { key: \"total_interest_topup\", patterns: [\"total interest top-up\", \"total.*interest.*top\", \"total interest\"] },\n  { key: \"today_register\", patterns: [\"today.*register\", \"today's register\", \"register.*today\"] },\n  { key: \"total_register_bonus\", patterns: [\"total register.*bonus\", \"total.*register.*bonus\", \"register get bonus\"] },\n  { key: \"today_send_voice\", patterns: [\"today send voice\", \"send voice\", \"today.*send.*voice\"] },\n  { key: \"today_voice_call\", patterns: [\"today voice call\", \"voice call\", \"today.*voice.*call\"] },\n  { key: \"today_video_call\", patterns: [\"today video call\", \"video call\", \"today.*video.*call\"] },\n  { key: \"first_recharge_amount\", patterns: [\"first recharge\", \"first.*recharge.*amount\"] },\n  { key: \"today_topup_amount\", patterns: [\"total top-up amount\", \"total.*topup.*amount\", \"top-up amount.*today\"] },\n  { key: \"client_withdraw_amount\", patterns: [\"client withdraw\", \"withdraw amount\", \"withdrawal.*today\"] },\n]\n\nfunction extractNumberFromLine(line: string): number {\n  const cleaned = line.replace(/[$¥€£,]/g, \"\")\n  const matches = cleaned.match(/[\\d]+\\.?[\\d]*/g)\n  if (matches && matches.length > 0) {\n    return Number.parseFloat(matches[matches.length - 1]) || 0\n  }\n  return 0\n}\n\nfunction parseTextData(text: string): Record<string, number> {\n  const result: Record<string, number> = {}\n  const lines = text.toLowerCase().split(/[\\n\\r]+/)\n\n  ACTIVITY_PATTERNS.forEach(({ key }) => {\n    result[key] = 0\n  })\n\n  for (const line of lines) {\n    if (!line.trim()) continue\n\n    for (const { key, patterns } of ACTIVITY_PATTERNS) {\n      for (const pattern of patterns) {\n        const regex = new RegExp(pattern, \"i\")\n        if (regex.test(line)) {\n          const value = extractNumberFromLine(line)\n          result[key] = value\n          break\n        }\n      }\n    }\n  }\n\n  const numberedPattern = /^(\\d+)[.):\\s]+.*?(\\d+\\.?\\d*)$/\n  for (const line of lines) {\n    if (!line.trim()) continue\n\n    const match = line.match(numberedPattern)\n    if (match) {\n      const lineNumber = Number.parseInt(match[1])\n      const value = Number.parseFloat(match[2]) || 0\n\n      const keyMap: Record<number, string> = {\n        1: \"new_clients\",\n        2: \"today_trust_love\",\n        3: \"total_trust_love\",\n        4: \"today_hot_chat\",\n        5: \"total_hot_chat\",\n        6: \"today_test_size_cut\",\n        7: \"today_size_cut\",\n        8: \"today_new_free_task\",\n        9: \"total_free_task\",\n        10: \"today_promote_topup\",\n        11: \"today_promote_success\",\n        12: \"today_new_interesting_clients\",\n        13: \"total_interest_topup\",\n        14: \"today_register\",\n        15: \"total_register_bonus\",\n        16: \"today_send_voice\",\n        17: \"today_voice_call\",\n        18: \"today_video_call\",\n        19: \"first_recharge_amount\",\n        20: \"today_topup_amount\",\n        21: \"client_withdraw_amount\",\n      }\n\n      if (keyMap[lineNumber]) {\n        result[keyMap[lineNumber]] = value\n      }\n    }\n  }\n\n  return result\n}\n\nfunction extractSequentialNumbers(text: string): Record<string, number> {\n  const result: Record<string, number> = {}\n  const keys = [\n    \"new_clients\",\n    \"today_trust_love\",\n    \"total_trust_love\",\n    \"today_hot_chat\",\n    \"total_hot_chat\",\n    \"today_test_size_cut\",\n    \"today_size_cut\",\n    \"today_new_free_task\",\n    \"total_free_task\",\n    \"today_promote_topup\",\n    \"today_promote_success\",\n    \"today_new_interesting_clients\",\n    \"total_interest_topup\",\n    \"today_register\",\n    \"total_register_bonus\",\n    \"today_send_voice\",\n    \"today_voice_call\",\n    \"today_video_call\",\n    \"first_recharge_amount\",\n    \"today_topup_amount\",\n    \"client_withdraw_amount\",\n  ]\n\n  const numbers = text.match(/[\\d]+\\.?\\d*/g) || []\n\n  keys.forEach((key, index) => {\n    result[key] = index < numbers.length ? Number.parseFloat(numbers[index]) || 0 : 0\n  })\n\n  return result\n}\n\nexport async function POST(req: Request) {\n  try {\n    const { text, image } = await req.json()\n\n    if (image && !text) {\n      return Response.json(\n        {\n          error:\n            \"Image processing requires AI. Please paste text data instead, or add a credit card to your Vercel account to enable AI features.\",\n          requiresAI: true,\n        },\n        { status: 400 },\n      )\n    }\n\n    if (!text) {\n      return Response.json({ error: \"No text data provided\" }, { status: 400 })\n    }\n\n    let activities = parseTextData(text)\n\n    const nonZeroCount = Object.values(activities).filter((v) => v > 0).length\n    if (nonZeroCount < 3) {\n      activities = extractSequentialNumbers(text)\n    }\n\n    return Response.json({ activities })\n  } catch (error) {\n    console.error(\"Error extracting activities:\", error)\n    return Response.json({ error: \"Failed to extract activities\" }, { status: 500 })\n  }\n}\n"],"names":[],"mappings":"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"}}]
}